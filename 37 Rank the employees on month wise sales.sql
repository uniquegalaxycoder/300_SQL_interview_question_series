-- write a query to rank the sales people by monthly sales resetting 
-- the rank every month according to monthly acchivement

CREATE TABLE sales (
    sales_id BIGINT PRIMARY KEY,
    sales_date DATE,
    emp_id BIGINT,
    invoice_amount FLOAT(10,2)
);

INSERT INTO sales (sales_id, sales_date, emp_id, invoice_amount) VALUES 
(1, '2025-01-01', 101, 1200.50), (2, '2025-01-02', 102, 450.00), (3, '2025-01-03', 103, 2100.00),
(4, '2025-01-04', 104, 890.75), (5, '2025-01-05', 105, 3400.00), (6, '2025-01-06', 106, 150.20),
(7, '2025-01-07', 107, 2200.00), (8, '2025-01-08', 108, 4500.00), (9, '2025-01-09', 109, 130.50),
(10, '2025-01-10', 110, 2750.00), (11, '2025-01-12', 101, 640.00), (12, '2025-01-15', 102, 1900.00),
(13, '2025-01-18', 103, 150.00), (14, '2025-01-20', 104, 3100.20), (15, '2025-01-22', 105, 980.00),
(16, '2025-01-25', 106, 5200.00), (17, '2025-01-28', 107, 430.00), (18, '2025-01-30', 108, 1250.00),
(19, '2025-02-01', 109, 2100.50), (20, '2025-02-03', 110, 880.00), (21, '2025-02-05', 101, 1550.00),
(22, '2025-02-07', 102, 3200.00), (23, '2025-02-10', 103, 140.75), (24, '2025-02-12', 104, 2900.00),
(25, '2025-02-15', 105, 750.00), (26, '2025-02-18', 106, 1100.00), (27, '2025-02-20', 107, 1950.40),
(28, '2025-02-22', 108, 4200.00), (29, '2025-02-25', 109, 500.00), (30, '2025-02-28', 110, 2650.00),
(31, '2025-03-01', 101, 310.00), (32, '2025-03-03', 102, 4100.00), (33, '2025-03-05', 103, 250.00),
(34, '2025-03-07', 104, 1800.00), (35, '2025-03-10', 105, 990.00), (36, '2025-03-12', 106, 720.00),
(37, '2025-03-15', 107, 3300.50), (38, '2025-03-18', 108, 150.00), (39, '2025-03-20', 109, 2800.00),
(40, '2025-03-22', 110, 1200.00);

select 
  *,
  rank()over(partition by months order by total_sales desc) as sales_rank
from (
      select 
        emp_id,
        date_format(sales_date, '%M') as months,
        count(sales_id) as total_quntity,
        sum(invoice_amount) as total_sales
      from sales 
      group by emp_id, date_format(sales_date, '%M')
)as t ;
